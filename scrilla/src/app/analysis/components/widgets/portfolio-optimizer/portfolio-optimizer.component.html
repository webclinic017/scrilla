<div class="widget-container">
    <mat-card class="input-card" [@toHeight]="this.inputCardAnimationControl.toHeight">
        <mat-card-title>
            <div class="title">
                <div>Input</div>
                <div class="action-group">
                    <div class="action=button">
                        <button mat-raised-button color="primary"
                                matTooltip="Take a tour of the Portfolio Optimization app"
                                [@scale]="tutorialBtnAnimationControl.scale"
                                (mouseenter)="tutorialBtnAnimationControl = animator.animateScale()"
                                (mouseleave)="tutorialBtnAnimationControl = animator.initAnimation()"
                                (click)="stepTutorial()">
                            {{ whichStep !== undefined ? 'Show Next' : 'Tutorial'}}
                        </button>
                    </div>
                    <div class="action-button">
                        <button mat-raised-button color="accent"
                            #tutorialTooltip="matTooltip"
                            matTooltip="6. Once all the input and constraints have been set, click this button to optimize your portfolio"
                            matTooltipDisabled="true"
                            [disabled]="tickers.length === 0 || (tickers.length > 0 && portfolio !== undefined) ||
                                        ( modeSelection.value === modes.minimizeConditionalValueAtRisk && (!probability || !expiry)) "
                            [@scale]="optimizeBtnAnimationControl.scale"
                            (mouseenter)="optimizeBtnAnimationControl = animator.animateScale()"
                            (mouseleave)="optimizeBtnAnimationControl = animator.initAnimation()"
                            (click)="optimize()">
                            Optimize
                        </button>
                    </div>
                </div>
            </div>

            
        </mat-card-title>
        <mat-card-subtitle>Mode: {{modeSelection.value.title}} {{whichStep}}</mat-card-subtitle>
        <mat-card-content>

            <div class="arguments-container">
                <section id="mode-selection" class="item mat-elevation-z3"
                    #tutorialTooltip="matTooltip"
                    matTooltip="1. Select an optimization mode. You can choose from a strategy that will either minimize your portfolio volatility, maximize your portfolio's sharpe ratio, or minimize your portfolio's conditional value at risk"
                    matTooltipDisabled="true">
                    <h2>Mode</h2>
                    <mat-button-toggle-group aria-label="Mode Selection" vertical 
                                            [formControl]="modeSelection">
                        <mat-button-toggle [value]="modes.minimizeVariance"
                                            matTooltip="Minimize Portfolio Variance"
                                            aria-label="Minimize Portfolio Variance">
                            <mat-icon [color]="modeSelection.value === modes.minimizeVariance ? 'accent' : 'primary'">filter_1</mat-icon>
                        </mat-button-toggle>
                        <mat-button-toggle [value]="modes.maximizeSharpeRatio"
                                            matTooltip="Maximize Portfolio Sharpe Ratio"
                                            aria-label="Maximize Portfolio Sharpe Ratio">
                            <mat-icon [color]="modeSelection.value === modes.maximizeSharpeRatio ? 'accent' : 'primary' ">filter_2</mat-icon>
                        </mat-button-toggle>
                        <mat-button-toggle [value]="modes.minimizeConditionalValueAtRisk"
                                            matTooltip="Minimize Portfolio Conditional Value At Risk"
                                            aria-label="Minimize Portfolio Conditional Value at Risk">
                            <mat-icon [color]="modeSelection.value === modes.minimizeConditionalValueAtRisk ?'accent' : 'primary' ">filter_3</mat-icon>
                        </mat-button-toggle>
                    </mat-button-toggle-group>
                </section>

                <section id="optional-toggle" class="item mat-elevation-z2" [formGroup]="optionalArguments"
                    #tutorialTooltip="matTooltip" matTooltipPosition="above"
                    matTooltip="2. Select any optional constraints you want to impose on your portfolio."
                    matTooltipDisabled="true">
                    <h2>Optional Input</h2>
                    <div formGroupName="target">
                        <mat-checkbox formControlName="enabled" aria-label="Target Return Input, Optional"
                                     matTooltip="Portfolio volatility will be minimized if no target return is specified.">
                        Target Return
                        </mat-checkbox>
                    </div>
                    <div formGroupName="invest">
                        <mat-checkbox formControlName="enabled" aria-label="Total Investent Input, Optional"
                                    matTooltip="Portfolio allocations will be given in percentage terms if no investment is specified.">
                        Total Investment
                        </mat-checkbox>
                    </div>
                    <div formGroupName="date">
                        <mat-checkbox formControlName="enabled" aria-label="Date Range Selection, Optional"
                                    matTooltip="Sample data defaults to last 100 trading days if no date range is specified.">
                        Date Range
                        </mat-checkbox>
                    </div>
                </section>

                <span id="ticker-input" class="item mat-elevation-z2">
                    <app-tickers [disabled]="portfolio !== undefined"
                                #tutorialTooltip="matTooltip"
                                matTooltip="3. Enter a basket of assets separated by a comma. Equities should be specified by ticker symbols from the NYSE Listing Directory and cryptocurrencies should be specified by their corresponding tickers from Coinbase."
                                [matTooltipDisabled]="whichStep !== 2"
                                (tickers)="setTickers($event)"></app-tickers>
                </span>

                <span id="probability-input" class="item mat-elevation-z2" [@fold]
                        *ngIf="modeSelection.value === modes.minimizeConditionalValueAtRisk">
                    <app-scalar title="Probability of Loss"
                                [disabled]="portfolio !== undefined"
                                [currency]="false"
                                [bounds]="[0,1]"
                                (scalar)="setProbability($event)"></app-scalar>
                </span>

                <span id="expiry-input" class="item mat-elevation-z3" [@fold]
                        *ngIf="modeSelection.value === modes.minimizeConditionalValueAtRisk">
                    <app-scalar title="Time Until Loss"
                                [disabled]="portfolio !== undefined"
                                [currency]="false"
                                (scalar)="setExpiry($event)"></app-scalar>
                </span>

                <span id="target-input" class="item mat-elevation-z2" [@fold]
                        #tutorialTooltip="matTooltip"
                        matTooltip="5. If you selected an optional input, enter a value."
                        matTooltipDisabled="true"
                        *ngIf="optionalArguments.get('target.enabled')?.value">
                    <app-scalar title="Target Return"
                                #targetInput
                                [disabled]="portfolio !== undefined"
                                [currency]="false"
                                (scalar)="setTarget($event)" ></app-scalar>
                </span>

                <span id="invest-input" class="item mat-elevation-z2" [@fold]
                        *ngIf="optionalArguments.get('invest.enabled')?.value">
                    <app-scalar title="Total Investment"
                                [disabled]="portfolio !== undefined"
                                [currency]="true"
                                (scalar)="setInvestment($event)"></app-scalar>
                </span>

                <span id="date-input" class="item mat-elevation-z3" [@fold]
                        *ngIf="optionalArguments.get('date.enabled')?.value">
                    <app-date [disabled]="portfolio !== undefined" 
                            (dates)="setDates($event)"></app-date>
                </span>
            </div>
        </mat-card-content>
    </mat-card>

    <mat-progress-bar *ngIf="loading" mode="buffer" color="accent"></mat-progress-bar>

    <mat-card class="output-card" [@toHeight]="this.outputCardAnimationControl.toHeight">
        <mat-card-title>
            <div class="title">
                <div>
                    Output
                </div>
                <div class="action-button-group">
                    <div class="action-button">
                        <button mat-raised-button color="warn"
                            [disabled]="!portfolio"
                            [@scale]="clearBtnAnimationControl.scale"
                            (mouseenter)="clearBtnAnimationControl = animator.animateScale()"
                            (mouseleave)="clearBtnAnimationControl = animator.initAnimation()"
                            (click)="clear()">
                            Clear
                        </button>
                    </div>
                </div>
            </div>
        </mat-card-title>
        <mat-card-content>
            <div class="result-container">
                <div class="item side-item">
                    <app-constraints [disabled]="portfolio !== undefined"
                                     [tickers]="this.tickers" [dates]="this.dates"
                                     [invest]="this.totalInvestment" [target]="this.targetReturn" 
                                     [probability]="this.probability" [expiry]="this.expiry"
                                     (removeTicker)="removeTicker($event)" (removeDates)="removeDates()"
                                     (removeTarget)="removeTarget()" (removeInvest)="removeInvestment()"
                                     (removeProbability)="removeProbability()" (removeExpiry)="removeExpiry()">
                    </app-constraints>
                </div>
                <div class="item main-item">
                    <app-allocation *ngIf="this.portfolio" [portfolio]="this.portfolio">
                    </app-allocation>
                </div>
            </div>
        </mat-card-content>
    </mat-card>

</div>